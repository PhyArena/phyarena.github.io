<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PhyArena</title>
  <style>
    :root{
      --bg:#f6f8fb; --card:#ffffff; --ink:#0f172a; --muted:#5b6476; --line:#e5e7eb;
      --gold:#ffd23f; --gold-weak:#ffe26f; --silver:#bfc9d2; --silver-weak:#d9e3ea; --bronze:#e28e54; --bronze-weak:#f6caa7;
      --chip:#f3f4f6; --chip-border:#e5e7eb; --accent:#0ea5e9; --shadow:0 8px 30px rgba(2,6,23,.08);
    }
    *{box-sizing:border-box}

    /* Hero */
    header.hero {
      min-height: 100vh;
      width: 100vw;   /* ← 改成100vw */
      margin: 0;      /* ← 确保没受其他外边距影响 */
      background: linear-gradient(180deg, #82b2ec 0%, #f6f9ff 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px 20px;
      box-sizing: border-box;
      text-align: center;
    }

    .hero-inner {
      width: 100%;
      max-width: none;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 36px;
      align-items: center;
      box-sizing: border-box;
    }

    header.hero h1 {
      margin: 0;
      font-size: 100px; /* ↑更大 */
      font-weight: 900; /* 加粗 */
      letter-spacing: 0.5px;
      color: var(--ink); /* 替代 #0f172a，用你已有的色板 */
    }

    header.hero .subtitle {
      margin-top: 10px;
      font-size: 22px;
      font-weight: 600;    /* ←加粗 */
      max-width: 1280px;
    }

    @media (max-width: 600px) {
      header.hero h1 {
        font-size: 48px; /* 手机端更小的标题 */
      }

      header.hero .subtitle {
        font-size: 16px;
        padding: 0 12px;
      }
    }

    body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:1280px;margin:0 auto;padding:24px}

    /* Fancy background accents */
    body::before{content:"";position:fixed;inset:-20% -10% auto -10%;height:60vh;background:radial-gradient(1200px 600px at 50% -10%, rgba(14,165,233,.12), transparent 60%), radial-gradient(800px 400px at 90% 10%, rgba(99,102,241,.10), transparent 60%);pointer-events:none;z-index:-1}

    /* Sticky topbar full width */
    .topbar{position:sticky;top:0;z-index:50;background:#ffffff;border-bottom:1px solid var(--line)}
    .topbar-inner{width:100%;display:flex;align-items:center;gap:14px;padding:14px 24px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{height:34px}
    .brand .word{font-weight:800;letter-spacing:.3px;font-size:20px;color:var(--ink)}
    .topnav{margin-left:auto;display:flex;gap:22px}
    .topnav a{font-size:15px;color:var(--muted)}

    /* Features */
    .features{max-width:900px;margin:22px auto 18px;display:flex;flex-direction:column;gap:14px;align-items:center}
    .feature-row{width:100%;display:flex;gap:12px;align-items:flex-start;background:linear-gradient(180deg,rgba(255,255,255,.9),#fff);border:1px solid var(--line);border-radius:12px;padding:12px 16px;box-shadow:var(--shadow)}
    .feature-icon{font-size:18px;line-height:26px}
    .feature-text{font-size:16px}

    /* CTA Tiles Section */
    .cta-tiles {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;              /* ✅ 自动换行 */
      gap: 18px;
      margin: 32px auto 48px;       /* ✅ 加大底部间距，避免遮挡下方表格 */
      max-width: 960px;             /* ✅ 控制最大宽度，保持视觉居中 */
      padding: 0 12px;              /* ✅ 手机端两边留白 */
    }

    /* Individual Tile */
    .tile {
      flex: 0 0 280px;              /* ✅ 固定宽度，避免拉伸 */
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 30px 16px;
      text-align: center;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: transform 0.12s ease;
    }

    .tile:hover {
      transform: translateY(-2px);
    }

    .tile h3 {
      margin: 0 0 6px;
      font-size: 24px;
    }

    .tile .sub {
      color: var(--muted);
      font-size: 16px;
    }

    /* Responsive: Full width on small screens */
    @media (max-width: 600px) {
      .tile {
        flex: 1 1 100%;            /* ✅ 撑满整行 */
        max-width: 100%;
      }

      .cta-tiles {
        margin-bottom: 64px;       /* ✅ 更大下边距，确保下方内容不被挡 */
      }
    }

    /* Tabs */
    .tabs{display:flex;gap:8px;margin:6px 0 12px}
    .tab{padding:10px 16px;border:1px solid var(--line);border-bottom:none;background:var(--card);border-radius:12px 12px 0 0;cursor:pointer;font-size:15px}
    .tab.active{background:#fff;font-weight:700;box-shadow:0 1px 0 #fff}

    /* Card */
    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 14px;
      box-shadow: var(--shadow);
      flex: 1 1 200px; /* 允许卡片宽度自适应（更灵活） */
      text-align: left;
    }

    /* Controls */
    .controls{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:8px;align-items:center}
    .controls label{font-size:12px;color:var(--muted)}
    .controls select,.controls input[type="text"]{padding:7px 11px;border:1px solid var(--line);border-radius:10px;background:#fff;min-width:150px}
    .pillgroup{display:flex;gap:6px;flex-wrap:wrap}
    .pill{border:1px solid var(--line);padding:6px 12px;border-radius:999px;background:#fff;cursor:pointer;font-size:12px}
    .pill.active{background:#eef6ff;border-color:#c5e0ff;color:#074fa5}

    /* Legend */
    .legend{display:flex;gap:12px;align-items:center;margin:6px 0 8px}
    .legend .chip{font-size:12px}

    /* Table */
    .table-wrap {
      max-height: 80vh;
      overflow-x: auto;
      overflow-y: auto;
      border: 1px solid var(--line);
      border-radius: 12px;
    }
    table {
      border-collapse: separate;
      border-spacing: 0;
      width: max-content; /* <== 原来是 100% */
      background: #fff;
      font-size: 12px;
    }
    th,td{padding:9px 10px;border-bottom:1px solid var(--line);white-space:nowrap}
    thead th{position:sticky;top:0;background:#fff;z-index:3;font-weight:700;border-bottom:1px solid var(--line)}
    thead tr.metahead th{font-weight:600}
    tbody tr:hover td:not(.med-gold):not(.med-silver):not(.med-bronze) {
      background: #fcfcff;
    }
    /* th:first-child, td:first-child{position:sticky;left:0;background:#fff;z-index:2} */
    /* thead th:first-child{z-index:4} */
    /* 用类名标记真正需要粘住的“Model列” */
    .sticky-left{position:sticky;left:0;background:#fff;z-index:2}
    /* 表头需要更高层级避免被覆盖 */
    thead .sticky-left{z-index:7}


    /* model chips */
    .chip{display:inline-block;border:1px solid var(--chip-border);border-radius:10px;padding:2px 8px;background:var(--chip)}
    .cat-blue{background:#cce9ff;border-color:#38bdf8;color:#064e7a}
    .cat-green{background:#c9f9df;border-color:#34d399;color:#065f46}
    .cat-purple{background:#e9d5ff;border-color:#c084fc;color:#6b21a8}
    .cat-yellow{background:#fff7cc;border-color:#fbbf24;color:#92400e}

    /* Medal cells – stronger */
    .med-gold{background:linear-gradient(180deg,var(--gold-weak),#fff)}
    .med-silver{background:linear-gradient(180deg,var(--silver-weak),#fff)}
    .med-bronze{background:linear-gradient(180deg,var(--bronze-weak),#fff)}

    .th-sort{cursor:pointer;user-select:none}
    .th-sort .arrow{opacity:.35;margin-left:6px}
    .th-sort.asc .arrow{opacity:1;transform:rotate(180deg)}
    .th-sort.desc .arrow{opacity:1}

    .muted{color:var(--muted)}
    .right{text-align:right}
    .center{text-align:center}
    .left{text-align:left}

    .th-inner {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      line-height: 1.2;
    }

    /* Section title */
    .section-title{text-align:center;font-size:34px;margin:6px 0 10px}
  </style>
</head>
<body>
  <!-- Sticky header bar (full width) -->
  <div class="topbar">
    <div class="topbar-inner">
      <a class="brand" href="#">
        <img src="assets/logo.png" alt="logo"/>
        <span class="word">PhyArena</span>
      </a>
      <nav class="topnav">
        <a href="#leaderboard">Leaderboard</a>
        <a href="#about">About</a>
      </nav>
    </div>
  </div>

  <!-- HERO -->
  <header class="hero">
    <div class="hero-inner">
      <h1>PhyArena</h1>
      <div class="subtitle">Benchmarking the physics reasoning of LLMs & MLLMs — from Olympiads to problem sets</div>

      <!-- FEATURES moved inside -->
      <div class="features">
        <div class="feature-row"><div class="feature-icon">🏆</div><div class="feature-text"><b>First Physics-Olympiad leaderboard</b> — 13 physics Olympiads from 2024–2025 with <b>official medal cutoffs</b>.</div></div>
        <div class="feature-row"><div class="feature-icon">🤖</div><div class="feature-text"><b>Direct human-model comparison</b> — HiPhO benchmarks (M)LLM exam scores against <b>human contestants</b>.</div></div>
        <div class="feature-row"><div class="feature-icon">🎓</div><div class="feature-text"><b>Rich difficulty spectrum</b> — PHYSICS spans <b>high school, Olympiad, undergraduate, and graduate levels</b>.</div></div>
      </div>

      <!-- CTA TILES moved inside -->
      <div class="cta-tiles">
        <div class="tile" id="btnHiPhO"><h3>HiPhO</h3><div class="sub">Physics Olympiad</div></div>
        <div class="tile" id="btnPHYSICS"><h3>PHYSICS</h3><div class="sub">Mixed Difficulty</div></div>
      </div>
    </div>
    </header>

    <div class="wrap">
    <!-- Tabs -->
    <div id="leaderboard" class="tabs">
      <div class="tab active" id="tab-hipho">HiPhO</div>
      <div class="tab" id="tab-physics">PHYSICS</div>
    </div>

    <!-- HiPhO Panel -->
    <section id="panel-hipho" class="card">
      <h3>
        <a href="https://arxiv.org/pdf/2509.07894" style="color: inherit; text-decoration: none;">
          HiPhO (High School Physics Olympiad Benchmark)
        </a>
      </h3>

      <div class="controls">
        <div>
          <label for="yearSel">Year</label><br>
          <select id="yearSel">
            <option value="all">All (2024 + 2025)</option>
            <option value="2025">Only 2025</option>
            <option value="2024">Only 2024</option>
          </select>
        </div>
        <div>
          <label>Competitions</label><br>
          <div class="pillgroup" id="compPills"></div>
        </div>
        <div>
          <label>Category</label><br>
          <div class="pillgroup" id="catPills"></div>
        </div>
        <div>
          <label for="modelSearch">Model</label><br>
          <input id="modelSearch" type="text" placeholder="Filter model…" />
        </div>
        <div class="muted">Metric: <b>exam score</b>. Tip: click any column header to sort.</div>
      </div>

      <div class="legend">
        <span>Legend:</span>
        <span class="chip cat-blue">Closed-source MLLM</span>
        <span class="chip cat-green">Open-source MLLM</span>
        <span class="chip cat-purple">Open-source LLM</span>
      </div>

      <div class="table-wrap" id="tableWrap">
        <table id="tbl">
          <thead id="thead"></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div class="muted" style="margin-top:8px; line-height:1.6"> 
        1. Cells are color-coded based on official medal thresholds. Models are ranked by Gold ↓, then Silver ↓, then Bronze ↓, with ties broken by IPhO 2025 score ↓.<br>
        2. Medal cutoffs are derived from the theoretical exam scores of human medalists.<br>
        3. Only the theoretical components of each exam are evaluated; experimental and diagram-drawing problems are excluded, so Full Mark (Model) ≤ Full Mark (Human).<br>
        4. Each model was run 8 times. Problem scores were averaged and summed to compute the final exam score.
      </div>
    </section>

    <!-- PHYSICS Panel -->
    <section id="panel-physics" class="card" style="display:none">
      <h3>
        <a href="https://arxiv.org/pdf/2506.00022" style="color: inherit; text-decoration: none;">
          PHYSICS Benchmark
        </a>
      </h3>

      <div class="controls">
        <div>
          <label for="domainSel">Domain</label><br>
          <select id="domainSel">
            <option value="all">All</option>
            <option value="Accuracy">Accuracy</option>
            <option value="Subject">Subject</option>
            <option value="Difficulty Level">Difficulty Level</option>
            <option value="Language">Language</option>
          </select>
        </div>
        <div>
          <label>Sub-domain</label><br>
          <div class="pillgroup" id="subcatPills"></div>
        </div>
        <div>
          <label>Category</label><br>
          <div class="pillgroup" id="physCatPills"></div>
        </div>
        <div>
          <label for="physModelSearch">Model</label><br>
          <input id="physModelSearch" type="text" placeholder="Filter model…" />
        </div>
        <div class="muted">Metric: <b>accuracy (%)</b>. Tip: click any column header to sort.</div>
      </div>

      <div class="legend">
        <span>Legend:</span>
        <span class="chip cat-blue">Closed-source reasoning model</span>
        <span class="chip cat-green">Open-source reasoning model</span>
        <span class="chip cat-purple">Closed-source chat model</span>
        <span class="chip cat-yellow">Open-source chat model</span>
      </div>

      <div class="table-wrap" id="physicsTableWrap">
        <table id="physicsTbl">
          <thead id="physicsThead"></thead>
          <tbody id="physicsTbody"></tbody>
        </table>
      </div>
      <div class="muted" style="margin-top:8px; line-height:1.6"> 
        1. Models are sorted by <b>Hybrid Acc</b> ↓ by default.<br>
        2. You can filter by domain (Accuracy / Subject / Difficulty Level / Language) and select specific sub-categories.<br>
        3. Values are rounded to 1 decimal place, consistent with the PHYSICS dataset paper.
      </div>
    </section>

    <!-- About -->
    <section id="about" class="card" style="margin-top:18px">
      <h2 class="section-title">What is PhyArena?</h2>
      <p style="max-width:900px;margin:0 auto 8px;text-align:left">
        <b>PhyArena</b> is an open leaderboard and evaluation suite to measure <em>physics reasoning</em> in LLMs and MLLMs. 
        It features recent Physics Olympiad exams and curated problem sets, offering a comprehensive evaluation.
      </p>
      <p style="max-width:900px;margin:0 auto 12px;text-align:left">
        We provide two complementary benchmarks. Click the links below to explore datasets, projects, and papers.
      </p>

      <h3 style="text-align:center">HiPhO — Physics Olympiad (multimodal)</h3>
      <p style="max-width:900px;margin:0 auto;text-align:left">HiPhO compiles 13 latest physics Olympiads from 2024–2025 (IPhO, APhO, EuPhO, NBPhO, PanPhO, PanMechanics, F=MA). It spans both international and regional competitions, and covering mixed modalities that encompass problems spanning text-only to diagram-based.</p>
      <div style="display:flex;justify-content:center;gap:18px;flex-wrap:wrap;margin:10px 0 18px">
        <a class="tile" id="linkHiphoDs" href="#" target="_blank" style="flex:0 0 200px"><h3 style="font-size:18px">Hugging Face</h3><div class="sub">dataset</div></a>
        <a class="tile" id="linkHiphoCode" href="#" target="_blank" style="flex:0 0 200px"><h3 style="font-size:18px">GitHub</h3><div class="sub">project</div></a>
        <a class="tile" id="linkHiphoPaper" href="#" target="_blank" style="flex:0 0 200px"><h3 style="font-size:18px">Paper</h3><div class="sub">pdf</div></a>
      </div>

      <h3 style="text-align:center">PHYSICS — Mixed Difficulty (text-only)</h3>
      <p style="max-width:900px;margin:0 auto;text-align:left">PHYSICS spans high-school, Olympiad, undergraduate, and graduate levels, offering text-only problems that test scaling and generalization beyond Olympiad exams. It is curated with exercises from over 100 textbooks through a carefully designed pipeline for quality control.</p>
      <div style="display:flex;justify-content:center;gap:18px;flex-wrap:wrap;margin:10px 0 0">
        <a class="tile" id="linkPhysDs" href="#" target="_blank" style="flex:0 0 200px"><h3 style="font-size:18px">Hugging Face</h3><div class="sub">dataset</div></a>
        <a class="tile" id="linkPhysCode" href="#" target="_blank" style="flex:0 0 200px"><h3 style="font-size:18px">GitHub</h3><div class="sub">project</div></a>
        <a class="tile" id="linkPhysPaper" href="#" target="_blank" style="flex:0 0 200px"><h3 style="font-size:18px">Paper</h3><div class="sub">pdf</div></a>
      </div>
    </section>
  </div>

  <script>
    // ===== External links (replace with your real URLs)
    const LINKS = {
      hipho: { dataset:'https://huggingface.co/datasets/SciYu/HiPhO', code:'https://github.com/SciYu/HiPhO', paper:'https://arxiv.org/abs/2509.07894' },
      physics: { dataset:'https://huggingface.co/datasets/desimfj/PHYSICS', code:'https://github.com/Zhengsh123/PHYSICS', paper:'https://arxiv.org/abs/2506.00022' }
    };

    function wireLinks(){
      linkHiphoDs.href = LINKS.hipho.dataset;
      linkHiphoCode.href = LINKS.hipho.code;
      linkHiphoPaper.href = LINKS.hipho.paper;
      linkPhysDs.href = LINKS.physics.dataset;
      linkPhysCode.href = LINKS.physics.code;
      linkPhysPaper.href = LINKS.physics.paper;
    }

    // ---------- HiPhO (Olympiads) ----------
    const HIPHO_CANONICAL_COLS = [
      {n:'IPhO',y:2025},{n:'IPhO',y:2024},
      {n:'APhO',y:2025},
      {n:'EuPhO',y:2025},{n:'EuPhO',y:2024},
      {n:'NBPhO',y:2025},{n:'NBPhO',y:2024},
      {n:'PanPhO',y:2025},{n:'PanPhO',y:2024},
      {n:'PanMechanics',y:2025},{n:'PanMechanics',y:2024},
      {n:'F=MA',y:2025},{n:'F=MA',y:2024}
    ];
    const HIPHO_CAT_LABELS = ['closed-source MLLM','open-source MLLM','open-source LLM'];

    let hiphoData = [];                 // olympiad entries
    let hiphoCategories = {};           // model -> category (HiPhO)
    let hiphoCtx = {};                  // key -> {thr, scores(Map), meta}
    let hiphoModels = [];               // all model names

    const yearSel = () => document.getElementById('yearSel').value;
    const selectedComps = new Set();    // competitions filter (HiPhO)
    const selectedHiphoCats = new Set(HIPHO_CAT_LABELS);

    // sort (HiPhO)
    let hiphoSortKey = null; // default medal comparator
    let hiphoSortDir = 'desc';

    function hiphoColKey(n,y){ return `${n}-${y}`; }

    async function loadHiphoData(){
      const res = await fetch('data/hipho.json',{cache:'no-store'});
      const json = await res.json();
      hiphoData = json.olympiads || [];
      hiphoCategories = json.model_categories || {};

      const modelSet = new Set(Object.keys(hiphoCategories));
      hiphoCtx = {};
      for(const o of hiphoData){
        const key = hiphoColKey(o.name,o.year);
        const map = new Map();
        for(const m of o.models){ map.set(m.name, m.score); modelSet.add(m.name); }
        hiphoCtx[key] = {
          thr:o.thresholds,
          scores:map,
          meta:{
            full_human: o.full_mark_human ?? o.full_mark?.human ?? null,
            full_model: o.full_mark_model ?? o.full_mark?.model ?? null,
            top1_human: o.top1_human ?? o.top1?.human ?? null,
            top1_model: o.top1_model ?? o.top1?.model ?? null
          }
        };
      }
      hiphoModels = Array.from(modelSet);
    }

    function hiphoHumanCols(){
      const y = yearSel();
      return HIPHO_CANONICAL_COLS.filter(c => (y==='all' || String(c.y)===y) && (selectedComps.size===0 || selectedComps.has(c.n)));
    }

    function hiphoComputeMedals(model){
      let g=0,s=0,b=0; const cols = hiphoHumanCols();
      for(const c of cols){
        const key = hiphoColKey(c.n,c.y), box = hiphoCtx[key]; if(!box) continue;
        const sc = box.scores.get(model);
        if(sc==null) continue;
        const {gold, silver, bronze} = box.thr;
        if(sc >= gold) g++; else if(sc >= silver) s++; else if(sc >= bronze) b++;
      }
      return {g,s,b};
    }

    function catClassHipho(name){
      const c = hiphoCategories[name];
      if(c==='closed-source MLLM') return 'cat-blue';
      if(c==='open-source MLLM') return 'cat-green';
      if(c==='open-source LLM') return 'cat-purple';
      // PHYSICS categories
      if(c==='closed-source reasoning model') return 'cat-blue';
      if(c==='open-source reasoning model') return 'cat-green';
      if(c==='closed-source chat model') return 'cat-purple';
      if(c==='open-source chat model') return 'cat-yellow';
      return '';
    }

    function buildCompPills(){
      const holder = document.getElementById('compPills');
      const comps = Array.from(new Set(HIPHO_CANONICAL_COLS.map(c=>c.n)));
      holder.innerHTML = '';
      for(const n of comps){
        const el = document.createElement('button');
        el.className = 'pill active';
        el.textContent = n;
        selectedComps.add(n);
        el.addEventListener('click', ()=>{
          if(selectedComps.has(n)){ selectedComps.delete(n); el.classList.remove('active'); }
          else { selectedComps.add(n); el.classList.add('active'); }
          hiphoRender();
        });
        holder.appendChild(el);
      }
    }

    function buildCatPills(){
      const holder = document.getElementById('catPills');
      holder.innerHTML = '';
      for(const label of HIPHO_CAT_LABELS){
        const el = document.createElement('button');
        el.className = 'pill active';
        el.textContent = label;
        el.addEventListener('click', ()=>{
          if(selectedHiphoCats.has(label)){ selectedHiphoCats.delete(label); el.classList.remove('active'); }
          else { selectedHiphoCats.add(label); el.classList.add('active'); }
          hiphoRender();
        });
        holder.appendChild(el);
      }
    }

    // ===== Sorting
    function hiphoAttachSortHandlers(){
      document.getElementById('thead').addEventListener('click',(e)=>{
        const th = e.target.closest('th.th-sort'); if(!th) return;
        const key = th.dataset.key;
        if(hiphoSortKey === key){ hiphoSortDir = (hiphoSortDir==='desc'?'asc':'desc'); }
        else { hiphoSortKey = key; hiphoSortDir = (key==='model'?'asc':'desc'); }
        hiphoRender();
      });
    }
    
    function hiphoDefaultComparator(a,b){
      if(b.g!==a.g) return b.g-a.g;
      if(b.s!==a.s) return b.s-a.s;
      if(b.b!==a.b) return b.b-a.b;
      const ka = a.scores[hiphoColKey('IPhO',2025)] ?? -Infinity;
      const kb = b.scores[hiphoColKey('IPhO',2025)] ?? -Infinity;
      if(kb!==ka) return kb-ka;
      return a.model.localeCompare(b.model);
    }

    function hiphoValueComparator(a,b,key){
      const va = key==='gold'?a.g:key==='silver'?a.s:key==='bronze'?a.b:key==='model'?a.model:b.scores[key];
      const vb = key==='gold'?b.g:key==='silver'?b.s:key==='bronze'?b.b:key==='model'?b.model:a.scores[key];
      if(key==='model') return hiphoSortDir==='asc'?String(va).localeCompare(String(vb)):String(vb).localeCompare(String(va));
      const A = (typeof va==='number')?va:-Infinity;
      const B = (typeof vb==='number')?vb:-Infinity;
      return (hiphoSortDir==='asc'?(A-B):(B-A));
    }

    // header with 7 meta rows
    function hiphoHeader(cols){
      const make = (label, key, align='center') =>
        `<th class="th-sort ${hiphoSortKey === key ? hiphoSortDir : ''} ${align==='left'?'left':'center'}" data-key="${key}">
          <div class="th-inner">${label}<span class="arrow">▾</span></div>
        </th>`;

      // 行1：Model（固定左侧）+ 奖牌 + 各竞赛列
      let html = '<tr>'
        + `<th class="th-sort ${hiphoSortKey==='model'?hiphoSortDir:''} left sticky-left" data-key="model">
            <div class="th-inner">Model<span class="arrow">▾</span></div>
          </th>`
        + make('🥇','gold') + make('🥈','silver') + make('🥉','bronze');
      for (const c of cols){
        html += make(`${c.n}<br>${c.y}`, hiphoColKey(c.n,c.y));
      }
      html += '</tr>';

      // 行2+：Full Mark / Cutoffs
      const rows = [
        {key:'full_human', name:'Full Mark (Human)', cls:''},
        {key:'full_model', name:'Full Mark (Model)', cls:''},
        {key:'gold',   name:'🥇 Gold Cutoff',   cls:'med-gold',   type:'thr'},
        {key:'silver', name:'🥈 Silver Cutoff', cls:'med-silver', type:'thr'},
        {key:'bronze', name:'🥉 Bronze Cutoff', cls:'med-bronze', type:'thr'}
      ];
      for (const r of rows){
        html += `<tr class="metahead">
                  <th class="left sticky-left">${r.name}</th>
                  <th class="center">—</th><th class="center">—</th><th class="center">—</th>`;
        for (const c of cols){
          const box = hiphoCtx[hiphoColKey(c.n,c.y)];
          const val = r.type==='thr' ? box?.thr?.[r.key] : box?.meta?.[r.key];
          html += `<th class="center ${r.cls}">${val==null?'—':Number(val).toFixed(1)}</th>`;
        }
        html += `</tr>`;
      }
      document.getElementById('thead').innerHTML = html;
    }


    // stack sticky header rows (key fix!)
    function stackStickyHeaderById(theadId){
      const thead = document.getElementById(theadId);
      const rows = Array.from(thead.querySelectorAll('tr'));
      let top = 0;
      for (const r of rows){
        const h = r.getBoundingClientRect().height || r.offsetHeight || 32;
        for (const th of r.children){
          th.style.position = 'sticky';
          th.style.top = top + 'px';
          // 普通表头层级 5；固定左列（Model）层级更高，确保不会被覆盖
          th.style.zIndex = th.classList.contains('sticky-left') ? 9 : 5;
        }
        top += h;
      }
    }

    // models
    function hiphoModelRows(cols){
      const q = document.getElementById('modelSearch').value.trim().toLowerCase();
      const data = [];
      for(const m of hiphoModels){
        if(q && !m.toLowerCase().includes(q)) continue;
        const cat = hiphoCategories[m];
        if(selectedHiphoCats.size>0 && !selectedHiphoCats.has(cat)) continue;
        const {g,s,b} = hiphoComputeMedals(m);
        const record = {model:m,g,s,b,scores:{}};
        for(const c of cols){
          const key = hiphoColKey(c.n,c.y); const box = hiphoCtx[key];
          record.scores[key] = box?.scores.get(m);
        }
        data.push(record);
      }
      if(!hiphoSortKey) data.sort(hiphoDefaultComparator);
      else data.sort((a,b)=>hiphoValueComparator(a,b,hiphoSortKey));

      const tb = [];
      for(const r of data){
        let tr = `<tr><td class="left"><span class="chip ${catClassHipho(r.model)}">${r.model}</span></td>`+
                `<td class="center">${r.g}</td><td class="center">${r.s}</td><td class="center">${r.b}</td>`;
        for(const c of cols){
          const key = hiphoColKey(c.n,c.y); const box = hiphoCtx[key]; const val = r.scores[key];
          const cls = (val==null)?'':(val>=box.thr.gold?'med-gold':val>=box.thr.silver?'med-silver':val>=box.thr.bronze?'med-bronze':'');
          tr += `<td class="center ${cls}">${val==null?'—':val.toFixed(1)}</td>`;
        }
        tr += '</tr>';
        tb.push(tr);
      }
      return tb.join('');
    }

    function hiphoRender(){
      const cols = hiphoHumanCols();
      hiphoHeader(cols);
      document.getElementById('tbody').innerHTML = hiphoModelRows(cols);
      stackStickyHeaderById('thead');
    }

    function hiphoAttachFilters(){
      document.getElementById('yearSel').addEventListener('change', hiphoRender);
      document.getElementById('modelSearch').addEventListener('input', hiphoRender);
    }

    
    // ---------- PHYSICS (Accuracy/Subject/Difficulty/Language) ----------
    const PHYSICS_DOMAINS = {
      'Accuracy': ['Hybrid Acc','Rule Acc'],
      'Subject': ['Mech.','Electromag.','Thermo.','Optics','Mod.'],
      'Difficulty Level': ['1','2','3','4'],
      'Language': ['EN','ZH']
    };
    // required default order:
    const PHYSICS_COLS_ORDER = ['Hybrid Acc','Rule Acc','Mech.','Electromag.','Thermo.','Optics','Mod.','1','2','3','4','EN','ZH'];

    const PHYSICS_CAT_LABELS = [
      'closed-source reasoning model',
      'open-source reasoning model',
      'closed-source chat model',
      'open-source chat model'
    ];

    let physMetrics = {};                 // metrics[domain][sub][model] = value
    let physCategories = {};              // model -> one of 4 types
    let physModels = [];                  // all model names
    let physSelectedDomain = 'all';
    let physSelectedSubs = new Set(PHYSICS_COLS_ORDER);
    let physSelectedCats = new Set(PHYSICS_CAT_LABELS);

    // sort (PHYSICS) – default by Hybrid Acc desc
    let physSortKey = 'Accuracy|Hybrid Acc';
    let physSortDir = 'desc';

    async function loadPhysicsData(){
      const res = await fetch('data/physics.json',{cache:'no-store'});
      const json = await res.json();
      physMetrics = json.metrics || {};
      // ← 修正键名：Difficult Level -> Difficulty Level
      if (physMetrics['Difficult Level'] && !physMetrics['Difficulty Level']) {
        physMetrics['Difficulty Level'] = physMetrics['Difficult Level'];
      }
      physCategories = json.model_categories || {};

      const set = new Set();
      for (const d of Object.keys(physMetrics)){
        for (const s of Object.keys(physMetrics[d]||{})){
          for (const m of Object.keys(physMetrics[d][s]||{})) set.add(m);
        }
      }
      physModels = Array.from(set);
    }

    function catClassPhys(name){
      const c = physCategories[name];
      if(c==='closed-source reasoning model') return 'cat-purple';
      if(c==='open-source reasoning model')   return 'cat-blue';
      if(c==='closed-source chat model')      return 'cat-green';
      if(c==='open-source chat model')        return 'cat-yellow';
      return '';
    }

    function physGetVal(model, domain, sub){
      const v = physMetrics?.[domain]?.[sub]?.[model];
      return (typeof v==='number') ? v : null;
    }

    function physActiveCols(){
      const out = [];
      const pushCols = (domain, arr) => {
        for (const sub of arr){
          if (physSelectedSubs.has(sub)) out.push({domain, sub});
        }
      };

      if (physSelectedDomain === 'all'){
        pushCols('Accuracy', PHYSICS_DOMAINS['Accuracy']);
        pushCols('Subject', PHYSICS_DOMAINS['Subject']);
        pushCols('Difficulty Level', PHYSICS_DOMAINS['Difficulty Level']);
        pushCols('Language', PHYSICS_DOMAINS['Language']);
      } else {
        pushCols(physSelectedDomain, PHYSICS_DOMAINS[physSelectedDomain] || []);
      }
      // 保持既定的从左到右顺序
      out.sort((a,b)=> PHYSICS_COLS_ORDER.indexOf(a.sub) - PHYSICS_COLS_ORDER.indexOf(b.sub));
      return out;
    }

    function physHeader(cols){
      // 统计大类的列跨度
      const groups = [];
      for (const c of cols){
        const last = groups[groups.length-1];
        if (last && last.domain === c.domain) last.span++;
        else groups.push({domain:c.domain, span:1});
      }

      // 顶行：Model（rowspan=2 + 固定左侧）+ 大类标题
      let html = '<tr>';
      html += `<th rowspan="2" class="th-sort ${physSortKey==='model'?physSortDir:''} left sticky-left" data-key="model">
                <div class="th-inner">Model<span class="arrow">▾</span></div>
              </th>`;
      for (const g of groups){
        html += `<th class="center" colspan="${g.span}">${g.domain}</th>`;
      }
      html += '</tr>';

      // 第二行：小类列（可排序）
      html += '<tr>';
      for (const c of cols){
        const key = `${c.domain}|${c.sub}`;
        html += `<th class="th-sort ${physSortKey===key?physSortDir:''} center" data-key="${key}">
                  <div class="th-inner">${c.sub}<span class="arrow">▾</span></div>
                </th>`;
      }
      html += '</tr>';

      document.getElementById('physicsThead').innerHTML = html;
    }


    function physValue(model, key){
      if(key==='model') return model;
      const [d,s] = key.split('|');
      return physGetVal(model, d, s);
    }

    function physComparator(a,b,key){
      if(key==='model'){
        return physSortDir==='asc' ? a.localeCompare(b) : b.localeCompare(a);
      }
      const va = physValue(a,key), vb = physValue(b,key);
      const A = (typeof va==='number')?va:-Infinity;
      const B = (typeof vb==='number')?vb:-Infinity;
      return physSortDir==='asc' ? (A-B) : (B-A);
    }

    function physModelRows(cols){
      const q = document.getElementById('physModelSearch').value.trim().toLowerCase();
      let models = physModels.filter(m=>{
        if(q && !m.toLowerCase().includes(q)) return false;
        const cat = physCategories[m];
        return physSelectedCats.size===0 || physSelectedCats.has(cat);
      });

      // default sort by Hybrid Acc desc
      const key = physSortKey || 'Accuracy|Hybrid Acc';
      models.sort((a,b)=>physComparator(a,b,key));

      const rows = [];
      for(const m of models){
        let tr = `<tr><td class="left"><span class="chip ${catClassPhys(m)}">${m}</span></td>`;
        for(const c of cols){
          const v = physGetVal(m, c.domain, c.sub);
          tr += `<td class="center">${v==null?'—':v.toFixed(1)}</td>`;
        }
        tr += '</tr>';
        rows.push(tr);
      }
      return rows.join('');
    }

    function physRender(){
      const cols = physActiveCols();
      physHeader(cols);
      document.getElementById('physicsTbody').innerHTML = physModelRows(cols);
      stackStickyHeaderById('physicsThead');
    }

    function physBuildCatPills(){
      const holder = document.getElementById('physCatPills');
      holder.innerHTML = '';
      for(const label of PHYSICS_CAT_LABELS){
        const el = document.createElement('button');
        el.className = 'pill active';
        el.textContent = label;
        el.addEventListener('click', ()=>{
          if(physSelectedCats.has(label)){ physSelectedCats.delete(label); el.classList.remove('active'); }
          else { physSelectedCats.add(label); el.classList.add('active'); }
          physRender();
        });
        holder.appendChild(el);
      }
    }

    function physBuildSubcatPills(){
      const holder = document.getElementById('subcatPills');
      holder.innerHTML = '';

      let subs = [];
      if (physSelectedDomain === 'all') {
        // ✅ 在 All 模式下，始终默认显示“全部列”
        subs = PHYSICS_COLS_ORDER.slice();
        physSelectedSubs = new Set(subs);            // ← 关键：重置为全选
      } else {
        subs = (PHYSICS_DOMAINS[physSelectedDomain] || []).slice();

        // 当前选择如果不属于该域或为空，则重置为该域的全部；
        // 否则把选择裁剪到该域范围内（避免残留上一个域的列名）。
        const scope = new Set(subs);
        if (physSelectedSubs.size === 0 ||
            ![...physSelectedSubs].every(s => scope.has(s))) {
          physSelectedSubs = new Set(subs);
        } else {
          physSelectedSubs = new Set([...physSelectedSubs].filter(s => scope.has(s)));
        }
      }

      // 渲染 pills（根据是否在选中集合里设置 active）
      for (const s of subs){
        const el = document.createElement('button');
        el.className = 'pill ' + (physSelectedSubs.has(s) ? 'active' : '');
        el.textContent = s;
        el.addEventListener('click', ()=>{
          if (physSelectedSubs.has(s)){ physSelectedSubs.delete(s); el.classList.remove('active'); }
          else { physSelectedSubs.add(s); el.classList.add('active'); }
          physRender();
        });
        holder.appendChild(el);
      }
    }

    function physAttachSortHandlers(){
      document.getElementById('physicsThead').addEventListener('click',(e)=>{
        const th = e.target.closest('th.th-sort'); if(!th) return;
        const key = th.dataset.key;
        if(physSortKey === key){ physSortDir = (physSortDir==='desc'?'asc':'desc'); }
        else { physSortKey = key; physSortDir = (key==='model'?'asc':'desc'); }
        physRender();
      });
    }

    // 兼容 value="Difficulty" / "Difficult Level"
    function normalizeDomain(d){
      if (d === 'Difficulty' || d === 'Difficult Level') return 'Difficulty Level';
      return d;
    }

    function physAttachFilters(){
      document.getElementById('domainSel').addEventListener('change',(e)=>{
        physSelectedDomain = normalizeDomain(e.target.value);   // <— 用规范化
        physBuildSubcatPills();

        if (physSelectedDomain === 'Accuracy' || physSelectedDomain === 'all'){
          physSortKey = 'Accuracy|Hybrid Acc'; physSortDir = 'desc';
        } else {
          const first = (PHYSICS_DOMAINS[physSelectedDomain]||[])[0];
          physSortKey = first ? `${physSelectedDomain}|${first}` : 'model';
          physSortDir = (physSortKey==='model' ? 'asc' : 'desc');
        }
        physRender();
      });
      document.getElementById('physModelSearch').addEventListener('input', physRender);
    }

    // ===== Tiles =====
    function setupTiles(){
      document.getElementById('btnHiPhO').addEventListener('click',()=>{
        document.getElementById('tab-hipho').click();
        document.getElementById('panel-hipho').scrollIntoView({behavior:'smooth'});
      });
      document.getElementById('btnPHYSICS').addEventListener('click',()=>{
        document.getElementById('tab-physics').click();
        document.getElementById('panel-physics').scrollIntoView({behavior:'smooth'});
      });
    }

    // ===== Tabs =====
    document.getElementById('tab-hipho').addEventListener('click',()=>{
      document.getElementById('tab-hipho').classList.add('active');
      document.getElementById('tab-physics').classList.remove('active');
      document.getElementById('panel-hipho').style.display='block';
      document.getElementById('panel-physics').style.display='none';
    });
    document.getElementById('tab-physics').addEventListener('click',()=>{
      document.getElementById('tab-physics').classList.add('active');
      document.getElementById('tab-hipho').classList.remove('active');
      document.getElementById('panel-physics').style.display='block';
      document.getElementById('panel-hipho').style.display='none';
    });

    // ===== Init =====
    (async function init(){
      wireLinks();

      // HiPhO
      await loadHiphoData();
      buildCompPills();
      buildCatPills();
      hiphoAttachFilters();
      hiphoAttachSortHandlers();
      hiphoRender();

      // PHYSICS
      await loadPhysicsData();
      physBuildCatPills();
      physBuildSubcatPills(); // based on default domain "all"
      physAttachFilters();
      physAttachSortHandlers();
      physRender();

      setupTiles();
    })();
  </script>
</body>
</html>
