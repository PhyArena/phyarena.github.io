<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PhyArena</title>
  <style>
    :root{
      --bg:#fafafa; --card:#ffffff; --ink:#0f172a; --muted:#475569; --line:#e5e7eb;
      --gold:#f8d34f; --gold-weak:#fff6cc; --silver:#cfd8dc; --silver-weak:#eef5f7; --bronze:#e0a36c; --bronze-weak:#fbf0e6;
      --chip:#f3f4f6; --chip-border:#e5e7eb; --accent:#0ea5e9;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:1280px;margin:0 auto;padding:24px}

    /* Header */
    header{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:16px;margin-bottom:18px}
    header .title{text-align:center}
    h1{margin:0;font-size:42px;letter-spacing:0.5px}
    .subtitle{margin-top:6px;color:var(--muted)}
    .logo-box{display:flex;align-items:center;gap:10px}
    .logo-box img{height:96px;object-fit:contain;filter: drop-shadow(0 1px 0 rgba(0,0,0,.03))}

    /* Tabs */
    .tabs{display:flex;gap:8px;margin:12px 0 16px}
    .tab{padding:8px 14px;border:1px solid var(--line);border-bottom:none;background:var(--card);border-radius:10px 10px 0 0;cursor:pointer}
    .tab.active{background:#fff;font-weight:600;box-shadow:0 1px 0 #fff}

    /* Card */
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px}

    /* Controls */
    .controls{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:10px;align-items:center}
    .controls label{font-size:12px;color:var(--muted)}
    .controls select,.controls input[type="text"]{padding:6px 10px;border:1px solid var(--line);border-radius:10px;background:#fff;min-width:150px}
    .pillgroup{display:flex;gap:6px;flex-wrap:wrap}
    .pill{border:1px solid var(--line);padding:4px 10px;border-radius:999px;background:#fff;cursor:pointer;font-size:12px}
    .pill.active{background:#eef6ff;border-color:#c5e0ff;color:#074fa5}

    /* Table */
    .table-wrap{max-height:68vh;overflow:auto;border:1px solid var(--line);border-radius:12px}
    table{border-collapse:separate;border-spacing:0;width:100%;background:#fff}
    th,td{padding:8px 10px;border-bottom:1px solid var(--line);white-space:nowrap}
    thead th{position:sticky;top:0;background:#fff;z-index:3;font-weight:600;border-bottom:1px solid var(--line)}
    tbody tr:hover td{background:#fcfcff}
    th:first-child, td:first-child{position:sticky;left:0;background:#fff;z-index:2}
    thead th:first-child{z-index:4}

    /* model chips */
    .chip{display:inline-block;border:1px solid var(--chip-border);border-radius:10px;padding:2px 8px;background:var(--chip)}
    .cat-closed{background:#e0f2fe;border-color:#38bdf8;color:#075985}
    .cat-open-mlm{background:#ecfdf5;border-color:#34d399;color:#065f46}
    .cat-open-llm{background:#f3e8ff;border-color:#c084fc;color:#6b21a8}

    /* medal backgrounds */
    .bg-gold{background:linear-gradient(180deg,var(--gold-weak),#fff)}
    .bg-silver{background:linear-gradient(180deg,var(--silver-weak),#fff)}
    .bg-bronze{background:linear-gradient(180deg,var(--bronze-weak),#fff)}

    .th-sort{cursor:pointer;user-select:none}
    .th-sort .arrow{opacity:.35;margin-left:6px}
    .th-sort.asc .arrow{opacity:1;transform:rotate(180deg)}
    .th-sort.desc .arrow{opacity:1}

    .muted{color:var(--muted)}
    .right{text-align:right}
    .center{text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo-box"><img src="logo.png" alt="logo"/></div>
      <div class="title">
        <h1>PhyArena</h1>
        <div class="subtitle">Evaluating LLMs and MLLMs on physics Olympiads and problem sets</div>
      </div>
      <div class="logo-box" aria-hidden="true"></div>
    </header>

    <div class="tabs">
      <div class="tab active" id="tab-hipho">HiPhO</div>
      <div class="tab" id="tab-physics">PHYSICS</div>
    </div>

    <!-- HiPhO Panel -->
    <section id="panel-hipho" class="card">
      <div class="controls">
        <div>
          <label for="yearSel">Year</label><br>
          <select id="yearSel">
            <option value="all">All (2024 + 2025)</option>
            <option value="2025">Only 2025</option>
            <option value="2024">Only 2024</option>
          </select>
        </div>
        <div>
          <label>Competitions</label><br>
          <div class="pillgroup" id="compPills"></div>
        </div>
        <div>
          <label for="modelSearch">Model</label><br>
          <input id="modelSearch" type="text" placeholder="Filter modelâ€¦" />
        </div>
        <div class="muted">Tip: click any column header to sort</div>
      </div>

      <div class="table-wrap" id="tableWrap">
        <table id="tbl">
          <thead id="thead"></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div class="muted" style="margin-top:8px">Cells are colored by medal thresholds of each contest. Medal counts (ðŸ¥‡/ðŸ¥ˆ/ðŸ¥‰) update with current filters.
      Default order: Gold â†“, then Silver â†“, Bronze â†“; tieâ€‘break by IPhO 2025 score â†“.</div>
    </section>

    <!-- PHYSICS Panel -->
    <section id="panel-physics" class="card" style="display:none">
      <div class="muted">PHYSICS benchmark coming soon.</div>
    </section>
  </div>

  <script>
    // ===== Constants and state
    const CANONICAL_COLS = [
      {n:'IPhO',y:2025},{n:'IPhO',y:2024},
      {n:'APhO',y:2025},
      {n:'EuPhO',y:2025},{n:'EuPhO',y:2024},
      {n:'NBPhO',y:2025},{n:'NBPhO',y:2024},
      {n:'PanPhO',y:2025},{n:'PanPhO',y:2024},
      {n:'PanMechanics',y:2025},{n:'PanMechanics',y:2024},
      {n:'F=MA',y:2025},{n:'F=MA',y:2024}
    ];
    let hiPho = [];            // raw olympiad entries
    let categories = {};       // model -> category
    let ctx = {};              // key -> {thr, scores: Map(model->score)}
    let allModels = [];        // list of model names

    const yearSel = () => document.getElementById('yearSel').value;
    const selectedComps = new Set(); // filled later

    function colKey(n,y){return `${n}-${y}`}

    async function loadData(){
      const res = await fetch('data/hipho.json', {cache:'no-store'});
      const json = await res.json();
      hiPho = json.olympiads || [];
      categories = json.model_categories || {};

      // Build ctx map and model list
      const modelSet = new Set(Object.keys(categories));
      ctx = {};
      for(const o of hiPho){
        const key = colKey(o.name,o.year);
        const map = new Map();
        for(const m of o.models){ map.set(m.name, m.score); modelSet.add(m.name); }
        ctx[key] = { thr:o.thresholds, scores:map };
      }
      allModels = Array.from(modelSet);
    }

    function humanCols(){
      const y = yearSel();
      return CANONICAL_COLS.filter(c => (y==='all' || String(c.y)===y) && (selectedComps.size===0 || selectedComps.has(c.n)));
    }

    function computeMedalsForModel(model){
      let g=0,s=0,b=0; const cols = humanCols();
      for(const c of cols){
        const key = colKey(c.n,c.y), box = ctx[key]; if(!box) continue;
        const sc = box.scores.get(model);
        if(sc==null) continue;
        const {gold, silver, bronze} = box.thr;
        if(sc >= gold) g++; else if(sc >= silver) s++; else if(sc >= bronze) b++;
      }
      return {g,s,b};
    }

    function catClass(name){
      const c = categories[name];
      if(c==='closed-source MLLM') return 'cat-closed';
      if(c==='open-source MLLM') return 'cat-open-mlm';
      if(c==='open-source LLM') return 'cat-open-llm';
      return '';
    }

    function buildCompPills(){
      const holder = document.getElementById('compPills');
      const comps = Array.from(new Set(CANONICAL_COLS.map(c=>c.n)));
      holder.innerHTML = '';
      for(const n of comps){
        const el = document.createElement('button');
        el.className = 'pill active';
        el.textContent = n;
        selectedComps.add(n);
        el.addEventListener('click', ()=>{
          if(selectedComps.has(n)){ selectedComps.delete(n); el.classList.remove('active'); }
          else { selectedComps.add(n); el.classList.add('active'); }
          render();
        });
        holder.appendChild(el);
      }
    }

    // ===== Sorting
    let sortKey = null; // null => default medal sort
    let sortDir = 'desc';

    function attachSortHandlers(){
      document.getElementById('thead').addEventListener('click', (e)=>{
        const th = e.target.closest('th.th-sort');
        if(!th) return;
        const key = th.dataset.key;
        if(sortKey === key){ sortDir = (sortDir==='desc'?'asc':'desc'); }
        else { sortKey = key; sortDir = (key==='model'?'asc':'desc'); }
        render();
      });
    }

    function defaultComparator(a,b){
      // medals desc, tie-break by IPhO-2025 score desc
      if(b.g!==a.g) return b.g-a.g;
      if(b.s!==a.s) return b.s-a.s;
      if(b.b!==a.b) return b.b-a.b;
      const ka = a.scores[colKey('IPhO',2025)] ?? -Infinity;
      const kb = b.scores[colKey('IPhO',2025)] ?? -Infinity;
      if(kb!==ka) return kb-ka;
      return a.model.localeCompare(b.model);
    }

    function valueComparator(a,b,key){
      const va = key==='gold'?a.g:key==='silver'?a.s:key==='bronze'?a.b:key==='model'?a.model:b.scores[key];
      const vb = key==='gold'?b.g:key==='silver'?b.s:key==='bronze'?b.b:key==='model'?b.model:a.scores[key];
      if(key==='model') return sortDir==='asc'?String(va).localeCompare(String(vb)):String(vb).localeCompare(String(va));
      const A = (typeof va==='number')?va:-Infinity;
      const B = (typeof vb==='number')?vb:-Infinity;
      return (sortDir==='asc'?(A-B):(B-A));
    }

    // ===== Render
    function header(cols){
      const make = (label,key)=>`<th class="th-sort ${sortKey===key?sortDir:''}" data-key="${key}">${label}<span class="arrow">â–¾</span></th>`;
      let html = '<tr>' + make('Model','model') + make('ðŸ¥‡ Gold','gold') + make('ðŸ¥ˆ Silver','silver') + make('ðŸ¥‰ Bronze','bronze');
      for(const c of cols){ html += make(`${c.n} ${c.y}`, colKey(c.n,c.y)); }
      html += '</tr>';
      document.getElementById('thead').innerHTML = html;
    }

    function cellClass(score, thr){
      if(score==null) return '';
      if(score >= thr.gold) return 'bg-gold';
      if(score >= thr.silver) return 'bg-silver';
      if(score >= thr.bronze) return 'bg-bronze';
      return '';
    }

    function rows(cols){
      const q = document.getElementById('modelSearch').value.trim().toLowerCase();
      const data = [];
      for(const m of allModels){
        if(q && !m.toLowerCase().includes(q)) continue;
        const {g,s,b} = computeMedalsForModel(m);
        const record = {model:m,g,s,b,scores:{}};
        for(const c of cols){
          const key = colKey(c.n,c.y); const box = ctx[key];
          record.scores[key] = box?.scores.get(m);
        }
        data.push(record);
      }
      // sort
      if(!sortKey) data.sort(defaultComparator); else data.sort((a,b)=>valueComparator(a,b,sortKey));

      // build html
      const tb = [];
      for(const r of data){
        let tr = `<tr><td><span class="chip ${catClass(r.model)}">${r.model}</span></td>`+
                 `<td class="right">${r.g}</td><td class="right">${r.s}</td><td class="right">${r.b}</td>`;
        for(const c of cols){
          const key = colKey(c.n,c.y); const box = ctx[key]; const val = r.scores[key];
          const cls = cellClass(val, box?.thr||{});
          tr += `<td class="right ${cls}">${val==null?'â€”':val.toFixed(1)}</td>`;
        }
        tr += '</tr>';
        tb.push(tr);
      }
      document.getElementById('tbody').innerHTML = tb.join('');
    }

    function render(){
      const cols = humanCols();
      header(cols);
      rows(cols);
    }

    function attachFilters(){
      document.getElementById('yearSel').addEventListener('change', ()=>{ render(); });
      document.getElementById('modelSearch').addEventListener('input', ()=>{ render(); });
    }

    // Tabs (placeholder)
    document.getElementById('tab-hipho').addEventListener('click',()=>{
      document.getElementById('tab-hipho').classList.add('active');
      document.getElementById('tab-physics').classList.remove('active');
      document.getElementById('panel-hipho').style.display='block';
      document.getElementById('panel-physics').style.display='none';
    });
    document.getElementById('tab-physics').addEventListener('click',()=>{
      document.getElementById('tab-physics').classList.add('active');
      document.getElementById('tab-hipho').classList.remove('active');
      document.getElementById('panel-physics').style.display='block';
      document.getElementById('panel-hipho').style.display='none';
    });

    // ===== Init
    (async function init(){
      await loadData();
      buildCompPills();
      attachFilters();
      attachSortHandlers();
      render();
    })();
  </script>
</body>
</html>